#!/usr/bin/env zsh
# 极速版 zshrc 配置
# 作者: Claude  
# 版本: 6.0

# 基础路径配置 - 静态设置，避免动态检查
export PATH="/opt/homebrew/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$HOME/bin:$HOME/.fnm:$PNPM_HOME"

# 快速显示帮助信息
printf '\033[0;34m=== 开发工具安装命令 ===\033[0m
\033[0;36mHomebrew:\033[0m /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
\033[0;36mOh-my-zsh:\033[0m sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
\033[0;36mfnm:\033[0m brew install fnm
\033[0;36mNode.js:\033[0m fnm install --lts && fnm default lts
\033[0;36mPlugins:\033[0m git clone https://github.com/zsh-users/zsh-{syntax-highlighting,autosuggestions}.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/
\033[0;36mz:\033[0m brew install z
\033[0;33m=== 安装后重启终端 ===\033[0m\n'

# 简单提示符
PS1='%F{cyan}%~%f %F{green}❯%f '

# 用户别名 - 直接定义
alias sho='ssh -o ServerAliveInterval=60 '
alias shozc='sho -p 7004 zczx@60.205.149.76'
alias vim='nvim'
alias tmux='TERM=screen-256color tmux -2'
alias proxy='export all_proxy=http://127.0.0.1:7897'
alias unproxy='unset all_proxy'
alias mvnd='mvn clean deploy -Dmaven.test.skip=true -Dmaven.compile.fork=true -T 1C'
alias mvnp='mvn clean package -Dmaven.test.skip=true -Dmaven.compile.fork=true -T 1C'

# 环境变量 - 静态设置
export ANDROID_HOME=$HOME/Library/Android/sdk
export MAVEN_HOME=/Users/ab/soft/mvn
export PNPM_HOME="/Users/ab/Library/pnpm"

# 懒加载函数 - 只有在实际使用时才初始化
_lazy_load_brew() {
  unfunction brew 2>/dev/null
  if [[ -f /opt/homebrew/bin/brew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  elif [[ -f /usr/local/bin/brew ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
  fi
  brew "$@"
}

_lazy_load_omz() {
  if [[ -d "$HOME/.oh-my-zsh" ]]; then
    export ZSH="$HOME/.oh-my-zsh"
    ZSH_THEME="robbyrussell"
    DISABLE_AUTO_UPDATE="true"
    plugins=(git z zsh-syntax-highlighting zsh-autosuggestions)
    source "$ZSH/oh-my-zsh.sh"
  fi
}

_lazy_load_fnm() {
  unfunction fnm node npm npx yarn pnpm 2>/dev/null
  if command -v fnm &>/dev/null; then
    eval "$(fnm env --use-on-cd)"
  fi
  "$0" "$@"
}

# 创建懒加载别名
if ! command -v brew &>/dev/null; then
  function brew() { _lazy_load_brew "$@"; }
fi

for cmd in fnm node npm npx yarn pnpm; do
  if ! command -v "$cmd" &>/dev/null; then
    eval "function $cmd() { _lazy_load_fnm \"\$@\"; }"
  fi
done

# 延迟加载 oh-my-zsh - 在后台异步加载
if [[ -d "$HOME/.oh-my-zsh" ]]; then
  { _lazy_load_omz } &|
fi
